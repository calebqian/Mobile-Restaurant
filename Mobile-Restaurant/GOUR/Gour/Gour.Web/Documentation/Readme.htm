<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!--TO READ THIS HELP FILE, RIGHT-CLICK ON THE FILE NAME IN THE
    SOLUTION EXPLORER WINDOW AND SELECT "VIEW IN BROWSER"-->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
    <title>Windows Phone Cloud Application Project Template</title>
    <style>
        BODY            { font-family: Verdana; font-size: 67% }
        .maindiv        { background: url('Images/side-vc.gif') repeat-y; padding-left: 55px; padding-top: 5px; position: relative; height: 50px }
        P               { margin-top: 0; margin-bottom: 6px; line-height: 130% }
        H1              { margin-top: 20px; margin-bottom: 12px; font-size: 190% }
        H2              { color: #585F56; left: -55px; position: relative; margin-top: 21px; margin-bottom: 9px; font-size: 170% }
        H3              { margin-top: 21px; margin-bottom: 9px; font-size: 140%; font-weight: bold }
        H4              { margin-top: 18px; margin-bottom: 9px; font-size: 140%; font-weight: bold }
        OL              { margin-top: 0; margin-bottom: 9px; line-height: 130% }
        UL              { margin-top: 0; margin-bottom: 9px; line-height: 130% }
        LI              { margin-top: 0; margin-bottom: 6px }
        BLOCKQUOTE      { margin-left: 20px }
        TABLE           { padding: 4px; background: #f8f7ef; border: #DDDCD6 1px solid; border-collapse: collapse; margin-bottom: 9px }
        TR              { vertical-align: top }
        TD              { padding: 4px; font-family: Verdana; font-size: 67%; line-height: 130% }
        .contents       { line-height: 150% }
        DIV.CodeBlock   { font-family: "Courier New"; font-size: 100%; margin-bottom: 6px; background: #f8f7ef; border: #eeede6 1px solid; padding: 10px; }
        .CodeInline     { font-family: "Courier New" }
        .ProcedureLabel { margin-top: 12px; font-style: italic; font-weight: bold; color: #0D4CC3 }
        .FileNameCol    { padding: 6px; background: #eeede6; width: 220px; font-weight: bold }
        img.note        { border: 0; margin-right: 3; }
        span.NoteHeader { font-size: 12px; }
    </style>
</head>
<body topmargin="0" leftmargin="0" rightmargin="20">
    <div class="maindiv">
        <a name="top"></a>
        <h1>
            Windows Phone Cloud Application Project Template</h1>
        <h2>
            <a href="#top">
                <img src="Images\topjump-vc.gif" border="0"></a><a name="Introduction">Introduction</a></h2>
        <p>
            The Windows Phone Cloud Application project template for Visual Studio makes it
            easier for developers to create a Windows Phone application that relies on Windows
            Azure Storage and SQL Azure. This template generates a Windows Azure project, an ASP.NET MVC 3
            project (configured as a Web role), and a Windows Phone application project.&nbsp;
            All these projects working together show how you can interact with Azure Storage
            without needing to include the storage account information (name and key) in the
            phone application.<br />
        </p>
        <h2>
            <a href="#top">
                <img src="Images\topjump-vc.gif" border="0" /></a><a name="RunningGeneratedWindowsPhoneCloudApplication">Running
                    and Going Through the Windows Phone Cloud Application</a></h2>
        <p>After creating a new Windows Phone Cloud Application project, perform these steps to go through the sample application generated.</p>

        <div class="alert">
          <table width="100%" cellspacing="0" cellpadding="0">
            <tr><th align="left"><img class="note" src="Images\note.gif" /><span class="NoteHeader">Note:</span></th></tr>
            <tr><td> If you face any problems while following these steps, please make sure to review the Troubleshooting section in the Toolkit Readme document.</td></tr>
          </table>
          <p />
        </div>

        <br />

        <p>
          <b>Starting the Application</b>
        </p>
        <ol>
          <li>Make sure that you do not have any Web site running in ports <b>443</b> and <b>10080</b> on your local IIS.<div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="Images\note.gif" /><span class="NoteHeader">Note:</span></th></tr><tr><td> By default, the ASP.NET MVC 3 Web role that is generated by the project template is configured to run over two different endpoints: one HTTPS in port 443 and another HTTP in port 10080.</td></tr></table><p /></div><br /></li>
          <li>Make sure that the target for <i>Silverlight for Windows Phone</i> projects is set to <b>Windows Phone Emulator</b>.<p><img src="images\Image1.png" /></p><br /></li>
          <li>In <b>Solution Explorer</b>, right-click the Windows Azure project, point to <b>Debug</b> and click <b>Start new instance</b>.</li>
          <li>Wait for the Web role to start and click the <b>Continue to this website (not recommended)</b> link to be able to browse the site despite of the certificate warning.<p>

              <img src="images\Image2.png" />

              </p><br />
          </li>
          <li>To log into the Web application use the following credentials:<ul><li>User Name: <b>admin</b></li><li>Password:<b> </b><img src="images\Image56.png" /> (with a zero)</li></ul></li>
          <li>In <b>Solution Explorer</b>, right-click the Windows Phone project, point to <b>Debug</b> and click <b>Start new instance</b>. This will launch the Windows Phone Emulator and start the application.</li>
          <li>The application will redirect you to the <b>log in</b> page. In the <b>log in</b> page, click the <b>Install certificate</b> link. This will open Internet Explorer in the Windows Phone Emulator at <a href="http://127.0.0.1:10080/127.0.0.1.cer">http://127.0.0.1:10080/127.0.0.1.cer</a>.<p>

            <img src="images\Image3.png" />

            </p><br />
            <div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left">
            <img class="note" src="Images\note.gif" /><span class="NoteHeader">Note:</span></th></tr><tr><td> In order to consume the REST services over HTTPS in a Windows Phone device or in the Windows Phone Emulator, you need to use a trusted SSL certificate. If you do not have one, you can use a self-signed certificate, but you need to install it in the phone before consuming the services.<br />Since the Computer Emulator always uses the 127.0.0.1 self-signed certificate, we need to install it in the Windows Phone Emulator before continuing with the next steps.</td></tr></table><p />
            </div><br />
          </li>
          <li>Click the shield icon to install the Compute Emulator’s certificate in the Windows Phone Emulator. Finally, click <b>install</b> to confirm that you want to install the certificate.<p><img src="images\Image5.png" /></p><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="Images\note.gif" /><span class="NoteHeader">Note:</span></th></tr><tr><td><b>Important:</b> If you leave the Windows Phone Emulator open, you do not need to install the certificate every time that you run the application. However, if you close the Windows Phone Emulator, you will have to install it again.</td></tr></table><p /></div><br /></li>
          <li>Once the certificate is installed, click <b>ok</b> and navigate back to the running application using the left arrow (<img src="images\Image6.png" />).<p><img src="images\Image7.png" /></p><br /></li>
        </ol>
        <div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="Images\note.gif" /><span class="NoteHeader">Note:</span></th></tr><tr><td>The menu items displayed in the Mobile Cloud Application Services Web site 
              and the pivot items shown in the phone application may differ depending on the option you selected in the template wizard steps. For example, if you selected SQL Azure Database as the <b>only</b> data provider, you will not see the Tables and Queues menu items.</td></tr></table><p /></div>

        <p>
          <b>Authenticating the user</b>
        </p>
        <ol>
          <li>From the <b>log in</b> page of the application, click <b>register</b>.</li>
          <li>In the <b>register</b> page, enter a username, e-mail and password, and then click <b>register</b>. Wait for the registration to complete. If the registration was successful, you will see the <b>Registration Successful</b> message. Click <b>ok</b> and you will be redirected back to the <b>log in</b> page.<p><img src="images\Image8.png" /></p><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="Images\note.gif" /><span class="NoteHeader">Note:</span></th></tr><tr><td> The Windows Phone Emulator supports mapping of the keyboard on your development computer to the hardware keyboard on a Windows Phone (by default is not enabled). To enable the keyboard in the Windows Phone Emulator press the <b>PAGE UP</b> or <b>PAUSE</b>/<b>BREAK</b> key. To disable it, press the <b>PAGE DOWN</b> or <b>PAUSE</b>/<b>BREAK</b> key. For more information, see the following article: <a href="http://msdn.microsoft.com/library/ff754352(VS.92).aspx">http://msdn.microsoft.com/library/ff754352(VS.92).aspx</a>.</td></tr></table><p /></div><br /></li>
          <li>Back in the <b>log in</b> page, enter the credentials of the user you have previously created and then click <b>log in</b>. If the log in is successful, you will be redirected to the main pivot page.<div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="Images\note.gif" /><span class="NoteHeader">Note:</span></th></tr><tr><td>In case you want to log in with different credentials, you need to log out by clicking the log out button (<img src="images\Image57.png" />) in the phone application bar, which will redirect you to the <b>log in</b> page.</td></tr></table><p /></div></li>
        </ol>


        <p>
          <b>Sending Microsoft Push Notifications</b>
        </p>
        <ol>
          <li>After the user authenticates, the <b>notification</b> pivot item is shown in the application. You will notice that push notifications are not enabled and therefore the connection status is disconnected.</li>
          <li>Check the <b>Enable push notifications</b> checkbox and wait until you see a message saying that the notification updates were received.<p><img src="images\Image11.png" /></p><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="Images\note.gif" /><span class="NoteHeader">Note:</span></th></tr><tr><td> When the user enables push notifications, the application is registered with Microsoft Push Notification Service (MPNS) and the sample notification service included in this toolkit. After doing that, the application then downloads the queued messages for that device if there is any available.<br />For more information about MPNS, you can read the <a href="http://windowsteamblog.com/windows_phone/b/wpdev/archive/2010/05/03/understanding-microsoft-push-notifications-for-windows-phones.aspx">Understanding Microsoft Push Notifications for Windows Phones</a> and <a href="http://windowsteamblog.com/windows_phone/b/wpdev/archive/2010/05/04/understanding-how-microsoft-push-notification-works-part-2.aspx">Understanding How Microsoft Push Notification Works – Part 2</a> articles.</td></tr></table><p /></div><br /></li>
          <li>Switch to the Web browser showing the Mobile Cloud Application Services Web site. Click the <b>Log On</b> link in the top-right corner.</li>
          <li>Enter the following credentials:<ul><li>User Name: <b>admin</b></li><li>Password:<b> </b><img src="images\Image56.png" /> (with a zero)</li></ul></li>
          <li>Once logged in, additional menu options will be shown to manage user permissions to tables, blobs and queues, and to send push notifications.<p><img src="images\Image12.png" /></p><br /></li>
          <li>Click the <b>Microsoft Push Notifications</b> menu option, type <b>raw message</b> in the textbox for the user you have just created and click <b>Send Raw</b>. You will see a success message.<p><img src="images\Image13.png" /></p><br /></li>
          <li>Now, type <b>tile message</b> in the textbox and click <b>Send Tile</b>. You will see an error message saying that the notification was not received by the device.<div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="Images\note.gif" /><span class="NoteHeader">Note:</span></th></tr><tr><td> In order to receive tile notifications you need to first pin the application to the Windows Phone Start menu.</td></tr></table><p /></div><br /><p><img src="images\Image14.png" /></p><br /></li>
          <li>Switch back to the Windows Phone Emulator. You will see the raw notification message displayed in the <b>Messages</b> list.<p><img src="images\Image15.png" /></p><br /></li>
          <li>Click the windows button (<img src="images\Image16.png" />) in the Windows Phone Emulator to navigate to the Start menu. In the Start menu, click the right arrow (<img src="images\Image17.png" />) to see the entire applications’ list. In the applications’ list, click the <b>WAT Windows Phone</b> icon and hold it for a few seconds until you see a contextual menu. In the contextual menu, click <b>pin to start</b>. This will redirect you back to the Start menu and you will now see the <b>WAT Windows Phone</b> application icon.<p><img src="images\Image18.png" /></p><br /></li>
          <li>Switch to the Web browser and click <b>Send Tile</b> to send the '<b>tile message</b>' notification again. You will now see a success message.<p><img src="images\Image19.png" /></p><br /></li>
          <li>Now, type <b>toast message</b> in the textbox and click <b>Send Toast</b>. You will see another success message.<p><img src="images\Image20.png" /></p><br /></li>
          <li>Switch back to the Windows Phone Emulator. You will see that the <b>WAT Windows Phone</b> icon now displays a number (in this case <b>1</b>) and there is a toast notification available too. Click on the toast notification or the icon to open the <b>WAT Windows Phone</b> application. In the <b>notifications</b> page, you will see that both messages ('<b>tile message</b>' and '<b>toast message</b>') are displayed in the <b>Messages</b> list.<p><img src="images\Image21.png" /></p><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="Images\note.gif" /><span class="NoteHeader">Note:</span></th></tr><tr><td> You were not redirected to the <b>log in</b> page because the authentication token that you had received the first time you logged in, is stored by default in the Isolated Storage.</td></tr></table><p /></div></li>
          <br />
        </ol>


      

        <p>
          <b>Working with SQL Azure Database</b>
        </p>
        <div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="images/note.gif" /><span class="NoteHeader">Note:</span></th></tr><tr><td>The application uses Entity Framework 4.1 Code First, in order to create the needed database tables. By default, a database will be created in the SQL Azure server with the same name as the base project name used during the template wizard creation.<br />In order to allow Entity Framework 4.1 Code to re-create the needed database tables when the model changes, it is necessary to add <i>Persist Security Info=True</i> to the connection string. This setting may not be suitable for production environments and you should consider removing it from your deployed applications.</td></tr></table><p /></div>
        <ol>
          <li>Flick or pan to the left to navigate to the <b>sql azure data</b> pivot item. You will see the rows available in the <b>SqlSampleData</b> table.<p><img src="images\Image46.png" /></p><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="images/note.gif" /><span class="NoteHeader">Note:</span></th></tr><tr><td> The <i>PushUserEndpoints</i>, <i>secMembership, UserPrivileges</i>and <i>secRole</i> tables are internally used by the toolkit services. Therefore, if you try to delete one of them you will get an error message saying that you do not have permissions.</td></tr></table><p /></div><br /></li>
          <li>Click the windows button (<img src="images\Image16.png" />) in the Windows Phone Emulator to navigate to the Start menu.</li>
          <li>Switch to the Web browser and click the <b>User</b> menu option. Notice that new users (like the one you have created) have by default granted permissions to access <b>Tables</b>, <b>Blobs</b>, <b>Queues </b>and<b> SQL Azure</b>.<p>
  
<img src="images\Image53.png" />
 
          </p><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="images/note.gif" /><span class="NoteHeader">Note:</span></th></tr><tr><td>The Web Site’s administrator user (<i>admin</i>) is displayed in the list only if the application is configured to use ASP.NET Membership authentication, in which case the admin user is also a valid application user.<br /> The columns Tables, Blobs and Queues are displayed only if the application is configured to use Windows Azure Storage.</td></tr></table><p /></div><br /></li>
          <li>Uncheck the <b>SQL</b> checkbox for the user you have created.<p>
  
<img src="images\Image54.png" />
 
          </p><br /></li>
          <li>Switch back to the Windows Phone Emulator and click the <b>WAT Windows Phone</b> icon to open the application again.</li>
          <li>Flick or pan back to left to navigate to the <b>sql azure data</b> pivot item. You will see error messages in the pages saying that you have no permissions to use SQL Azure.<p><img src="images\Image50.png" /></p><br /></li>
        </ol>

        &nbsp;<p>
            <a href="http://www.microsoft.com/info/cpyright.mspx">© Microsoft Corporation and/or
                its suppliers. All rights reserved. Terms of Use.</a>
            <p>
                <img src="Images/dpe.jpg" alt="Developer & Platform Evangelism" /></p>
            <p>
                &nbsp;</p>
    </div>
</body>
</html>
